<html>
<head>
<title>Empanadas.io</title>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta name="referrer" content="origin">
<meta name="application-name" content="Cloudflare">
<meta name="msapplication-TileColor" content="#1e1e91">
<style>
@font-face {
    font-family: Poppins;
    src: url(Poppins.ttf) format("truetype");
}

* {
	text-align: center;
    font-family: poppins,sans-serif;
	overflow: hidden;
	user-select: none;
	transition: 0.5s all ease;
}
html, body {
	background-color: #1e1e91;
	color: white;
	font-size:32px;
	height: 100%;
}
img {
  display: block;
  margin-left: auto;
  margin-right: auto;
  width: 20%;
  margin-top: 180px;
}

footer p {
	margin-bottom: 10px;
	font-size: 18px;
	padding-left: 10%;
	padding-right: 10%;
	font-weight:300;
	color:#abbefc;
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.0/animate.compat.css" crossorigin="anonymous">
</head>
<body>
<img class="animated fadeIn faster" style="animation-delay:250ms" id="logo" src="logo.png"></img>
<div class="animated fadeInUp" style="animation-delay:500ms;margin-top:20px;font-weight:1000;" id="msg">Empanadas.io</div>
<footer>
<p class="animated fadeInUp" style="animation-delay:525ms;" id="status">Communicating to Server...</p>
</footer>
<script src="Content/JS/jquery-3.5.1.min.js"></script>
<script>
const appbase = "https://empanadas.io/v2/dashboard";
const appparam = "?usingnativeapp=1";
const start = Date.now();
const logo = document.getElementById("logo");
const msg = document.getElementById("msg");
const status = document.getElementById("status");
const minwait = 2250;
let noint = false;
function noInt() {
	allowdownload = true;
	let noinmsg = "We were unable to talk to our empanada robots!<br>Double check that your beep-boop machines are on and within range.";
	if(!noint) {
		logo.src = "jeff.gif";
		logo.style.marginTop = "120px";
		// remove :( -> &#x1F61E; 
		msg.innerHTML = "Check Your Internet";
		status.innerHTML = noinmsg;
	}
	noint = true;
	setTimeout(function(){
		$.ajax({
			url: "https://empanadas.io/v2/ping.php",
			type: "GET",
			data: { usingnativeapp: 1, firsthello: 1}, 
			beforeSend: function() {
				//status.innerHTML += "\nChecking...";
			},
			success: function(data) {
				status.innerHTML = "Connected!";
				finishedLoading("&retried_network=1")
			},
			error: function() {
				//status.innerHTML = noinmsg;
				noInt();
				return;
			},
			dataType: 'text',
			cache: false
		});
	}, 5000);
}
function finishedLoading(params="") {
	if(navigator.onLine && !noint) {
		allowdownload = false;
		const end = Date.now();	
		setTimeout(function(){ 
			setTimeout(function(){ 
				if(!navigator.onLine) {
					noInt();
					return;
				}
				msg.style.display = "none";
				logo.style.display = "none";
				status.style.display = "none";
				msg.classList.remove("animated", "fadeOut", "faster");
				logo.classList.remove("animated", "fadeOut", "faster");
				status.classList.remove("animated", "fadeOut", "faster");
				console.log("GO: " + params);
				window.location.href = appbase+appparam+params;
			}, 480);
			logo.classList.remove("animated", "fadeIn", "faster");
			msg.classList.remove("animated", "fadeInUp");
			status.classList.remove("animated", "fadeInUp");
			logo.style.animationDelay = "0s";
			msg.style.animationDelay = "0s";
			status.style.animationDelay = "0s";
			setTimeout(function(){ 
			msg.classList.add("animated", "fadeOut", "faster");
			logo.classList.add("animated", "fadeOut", "faster");
			status.classList.add("animated", "fadeOut", "faster");
			}, 250);
		}, minwait-(end-start));
	} else {
		noInt();
	}
}

let allowdownload = true;
let downloaded = 0;
let canFinish = false;
let downloadsDone = false;
function download(ds) {
	if(!navigator.onLine || noint) { allowdownload = false; noInt(); return; }
	if(!allowdownload) { return; }
	
	$.ajax({
        url: "https://empanadas.io/v2/ping.php",
        type: "GET",
		data: { usingnativeapp: 1, firsthello: 1}, 
        beforeSend: function() {
            status.innerHTML = "Waiting for Server...";
        },
        success: function(data) {
            if(data == "Pong!") {
				canFinish = true;
				//if(downloadsDone) {
				//	finishedLoading("&sucessfulstart=1&fromping=1");
				//}
				status.innerHTML = "Connected";
				
				// just do it 
				downloadsDone = true;
				logo.style.marginTop = "200px";
				status.innerHTML = "";
				finishedLoading("&sucessfulstart=1&fromdownload=1");
            }
        },
        error: function() {
            allowdownload = false;
			noInt();
			return;
        },
        dataType: 'text',
        cache: false
    });
	
	return; // just don't even try;
	
	//var i, max = 0;
    //var o = null;

    //for (i = 0, max = ds.length; i < max; i += 1) {
	//	try {
	//		if(!allowdownload) { return; }
	//		o = document.createElement('object');
	//		o.onload = function() {
	//			downloaded++;
	//			const pdone = Math.min(Math.round((downloaded / max)*100), 100);
	//			status.innerHTML = "&#x1F4C1;  Updating:  <b>" + pdone + "%</b>";
	//			if (downloaded == max) {
	//				logo.style.marginTop = "200px";
	//				status.innerHTML = "";
	//				downloadsDone = true;
	//				if(canFinish) {
	//					finishedLoading("&sucessfulstart=1&fromdownload=1");
	//				}
	//			}
	//		};
	//		o.data = ds[i];
	//		o.width  = 0;
	//		o.height = 0;
	//		document.body.appendChild(o);
	//	} catch (err) {
	//		console.log("Error while getting cache: " + err.message);
	//		finishedLoading("&appcatcherr="+encodeURIComponent(err.message()));
	//	}
	//}
}

setTimeout(function(){
	if(navigator.onLine && !noint) {
		finishedLoading("&forceapptimeout=1");
	}
}, 10000);

// whatever just run it
download(null);
</script>

<!--<script src="https://api.empanadas.io/app/startup.js" onerror="noInt()"></script>-->
</body>
</html>